<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Line6 Â· çœ‹ä»·æ ¼åœ¨å†å²åŒºé—´é‡Œçš„ä½ç½®</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg: #0b0d10;
      --fg: #e8eef5;
      --muted: #92a2b3;
      --card: #13161b;
      --border: #222832;
      --accent: #7cc4ff;
      --up: #f97316;
      --down: #ef4444;
    }
    html, body { height: 100%; }
    body {
      margin: 0; font: 14px/1.5 ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: var(--bg); color: var(--fg);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px 16px 56px; }
    h1 { font-size: 22px; margin: 0 0 8px; }
    .sub { color: var(--muted); margin-bottom: 20px; }
    .grid { display: flex; flex-direction: column; gap: 16px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 14px; }
    .row { display: flex; align-items: center; gap: 10px; justify-content: space-between; }
    .sym { font-weight: 600; letter-spacing: .5px; }
    .muted { color: var(--muted); }
    .pill { padding: 2px 8px; border-radius: 999px; background: #0f1a24; color: var(--accent); border: 1px solid var(--border); }
    .footer { color: var(--muted); margin-top: 18px; font-size: 12px; }
    .legend { display:flex; flex-wrap: wrap; gap: 6px 10px; margin-top: 8px; }
    .legend span { display:inline-flex; align-items:center; gap:6px; }
    .dot { width:10px; height:10px; border-radius:2px; display:inline-block; }
    .tiny { font-size: 12px; }
    canvas { width: 100% !important; height: 280px !important; }
    .mini { display:flex; gap:10px; color:var(--muted); }
  .summary { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 10px; margin-top: 10px; }
.kpi { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 10px; padding: 8px 10px; }
.kpi small { display:flex; align-items:center; gap:6px; color: var(--muted); }
.kpi b { font-size: 14px; }
hr.div { border:0; border-top:1px solid var(--border); margin:10px 0; opacity:.7; }
</style>
</head>
<body>
  <div class="container">
    <h1>Line6</h1>
    <div class="sub">ç”¨ 6 æ¡æ°´å¹³çº¿ï¼ˆ3å¹´/1å¹´/6ä¸ªæœˆ çš„æœ€é«˜/æœ€ä½ï¼‰ + æ”¶ç›˜ä»·æ›²çº¿ï¼Œå¿«é€Ÿåˆ¤æ–­å½“å‰ä»·æ ¼æ‰€å¤„åŒºé—´ã€‚æ•°æ®æ¥æºï¼šä½ ä»“åº“é‡Œçš„ <code>data/*.json</code> é™æ€æ–‡ä»¶ã€‚</div>

    <div class="tiny muted" style="margin: 8px 0 16px;">
      ç¼–è¾‘ä¸‹æ–¹é…ç½®ä¸­çš„ <code>symbols</code> æ•°ç»„ä»¥åŠ <code>dataDir</code> è·¯å¾„ï¼ŒæŠŠå¯¹åº” JSON æ”¾åˆ°ä»“åº“é‡Œå³å¯ã€‚JSON ç»“æ„è§é¡µé¢åº•éƒ¨æ³¨é‡Šã€‚
    </div>

    <div id="cards" class="grid"></div>

    <div class="footer">
      ğŸ“Œ è¯´æ˜ï¼š
      <ul>
        <li>çª—å£ä»¥æ•°æ®ä¸­æœ€æ–°æ—¥æœŸä¸ºåŸºå‡†å›æº¯ 6M / 1Y / 3Yï¼›å¦‚æ•°æ®ä¸è¶³ï¼Œå°†è‡ªåŠ¨é€€åŒ–ä¸ºå¯ç”¨åŒºé—´ã€‚</li>
        <li>æ°´å¹³çº¿ä¸ºå„çª—å£å†…çš„æœ€é«˜/æœ€ä½æ”¶ç›˜ä»·ï¼ˆä¹Ÿå¯æ”¹æˆæœ€é«˜/æœ€ä½æ—¥å†…ä»·ï¼Œè§ä»£ç æ³¨é‡Šï¼‰ã€‚</li>
        <li>å»ºè®®æ¯å‘¨æˆ–æ”¶ç›˜åæ›´æ–°ä¸€æ¬¡ <code>data/</code> ä¸‹ JSON æ–‡ä»¶ï¼Œé¡µé¢ä¼šè‡ªåŠ¨åæ˜ æœ€æ–° 6 æ¡çº¿ã€‚</li>
      </ul>
    </div>
  </div>

  <script>
    // === é…ç½®åŒº ===
    const dataDir = 'data'; // é™æ€ JSON æ”¾ç½®ç›®å½•ï¼Œå¦‚ data/AAPL.json
    const symbols = ['AAPL', 'MSFT']; // ä½ è¦å±•ç¤ºçš„è‚¡ç¥¨ä»£ç ï¼ˆä¸ JSON æ–‡ä»¶åä¸€è‡´ï¼‰

    // === å·¥å…·å‡½æ•° ===
    const parseDate = (s) => new Date(s + 'T00:00:00');
    const fmt = (n) => (n == null || isNaN(n) ? 'â€”' : Number(n).toFixed(2));

    // è®¡ç®—çª—å£å†…çš„æœ€é«˜/æœ€ä½ï¼ˆè¿™é‡Œç”¨ closeï¼Œä½ ä¹Ÿå¯ä»¥æ”¹ç”¨ high/lowï¼‰
    function windowExtrema(rows, fromDate) {
      const w = rows.filter(r => parseDate(r.date) >= fromDate);
      if (w.length === 0) return { max: null, min: null };
      let mx = -Infinity, mn = Infinity;
      for (const r of w) {
        // ç”¨æ”¶ç›˜ä»·åšåŒºé—´åˆ¤æ–­ï¼›è‹¥æƒ³ç”¨æ—¥å†…æœ€é«˜/æœ€ä½ï¼ŒæŠŠ r.close æ”¹ä¸º r.high / r.low
        if (r.close > mx) mx = r.close;
        if (r.close < mn) mn = r.close;
      }
      return { max: mx, min: mn };
    }

    // ç”Ÿæˆæ°´å¹³çº¿æ•°æ®é›†ï¼ˆy = å¸¸æ•°ï¼‰
    function flatLine(label, y, xLabels, style={}) {
      const data = xLabels.map(() => y);
      return Object.assign({
        label,
        data,
        borderWidth: 1.5,
        borderDash: [6, 6],
        pointRadius: 0,
        fill: false,
      }, style);
    }

    function pct(a, b) { // å½“å‰ä»·ç›¸å¯¹åŒºé—´çš„ç™¾åˆ†ä½ï¼ˆç®€å•è®¡ç®—ï¼‰
      if (a == null || b == null) return null;
      return ((a - b.min) / (b.max - b.min)) * 100;
    }

    async function loadJSON(sym) {
      const res = await fetch(`${dataDir}/${sym}.json`, { cache: 'no-store' });
      if (!res.ok) throw new Error(`${sym} æ•°æ®æ–‡ä»¶è¯»å–å¤±è´¥`);
      const raw = await res.json();
      // æœŸæœ›æ•°æ®æŒ‰æ—¥æœŸå‡åºï¼›è‹¥ä¸æ˜¯ï¼Œåˆ™æ’åº
      raw.sort((a,b) => a.date.localeCompare(b.date));
      return raw.map(r => ({
        date: r.date,
        open: +r.open,
        high: +r.high,
        low: +r.low,
        close: +r.close,
      }));
    }

    function last(arr) { return arr[arr.length - 1]; }

    function makeCard(sym) {
      const el = document.createElement('div');
      el.className = 'card';
      el.innerHTML = `
        <div class="row" style="margin-bottom:8px;">
          <div class="sym">${sym}</div>
          <div class="mini">
            <span class="muted tiny">æœ€æ–°æ”¶ç›˜ï¼š<b id="${sym}-last">â€”</b></span>
            <span class="pill tiny" id="${sym}-pos">â€”</span>
          </div>
        </div>
        <canvas id="chart-${sym}"></canvas>
        <div class="legend tiny" id="legend-${sym}"></div>
<hr class="div"/>
<div class="summary tiny" id="${sym}-summary"></div>
      `;
      return el;
    }

    function legendColorBox(color, text) {
      return `<span><i class="dot" style="background:${color}"></i>${text}</span>`;
    }

    async function renderSymbol(sym) {
      const card = makeCard(sym);
      document.getElementById('cards').appendChild(card);

      try {
        const rows = await loadJSON(sym);
        if (!rows.length) throw new Error('æ— æ•°æ®');

        const latest = last(rows);
        const latestDate = parseDate(latest.date);

        // è®¡ç®—æ—¶é—´çª—å£
        const d6m = new Date(latestDate); d6m.setMonth(d6m.getMonth() - 6);
        const d1y = new Date(latestDate); d1y.setFullYear(d1y.getFullYear() - 1);
        const d3y = new Date(latestDate); d3y.setFullYear(d3y.getFullYear() - 3);

        const e6m = windowExtrema(rows, d6m);
        const e1y = windowExtrema(rows, d1y);
        const e3y = windowExtrema(rows, d3y);

        // X è½´æ ‡ç­¾ä¸ä¸»æŠ˜çº¿æ•°æ®ï¼ˆæ”¶ç›˜ï¼‰
        const labels = rows.map(r => r.date);
        const closes = rows.map(r => r.close);

        // è®¡ç®—å½“å‰ä»·ä½äº 1Y åŒºé—´çš„ç™¾åˆ†ä½ï¼ˆä¹Ÿå¯æ¢æˆ 6M/3Yï¼‰
        const p1y = pct(latest.close, e1y);
        const posEl = document.getElementById(`${sym}-pos`);
        if (p1y != null && isFinite(p1y)) {
          const p = Math.max(0, Math.min(100, p1y));
          posEl.textContent = `1YåŒºé—´ç™¾åˆ†ä½ï¼š${p.toFixed(1)}%`;
        } else {
          posEl.textContent = '1YåŒºé—´ç™¾åˆ†ä½ï¼šâ€”';
        }
        document.getElementById(`${sym}-last`).textContent = `${fmt(latest.close)} (${latest.date})`;

        // ä¸»é¢˜è‰²
        const closeColor = getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#7cc4ff';

        const ds = [
          // ä¸»æŠ˜çº¿ï¼šæ”¶ç›˜
          {
            label: 'æ”¶ç›˜ä»·',
            data: closes,
            borderWidth: 2,
            pointRadius: 0,
            tension: 0.25,
          },
          // æ°´å¹³çº¿ï¼š3Y/1Y/6M High/Low
          flatLine('3Y High', e3y.max, labels, { borderDash: [], borderWidth: 1, borderColor: '#eab308' }),
          flatLine('3Y Low',  e3y.min, labels, { borderDash: [6,4], borderColor: '#eab308' }),

          flatLine('1Y High', e1y.max, labels, { borderDash: [], borderWidth: 1, borderColor: '#f97316' }),
          flatLine('1Y Low',  e1y.min, labels, { borderDash: [6,4], borderColor: '#f97316' }),

          flatLine('6M High', e6m.max, labels, { borderDash: [], borderWidth: 1, borderColor: '#ef4444' }),
          flatLine('6M Low',  e6m.min, labels, { borderDash: [6,4], borderColor: '#ef4444' }),
        ];

        const ctx = document.getElementById(`chart-${sym}`).getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: ds,
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            scales: {
              x: {
                ticks: { maxRotation: 0, autoSkip: true, maxTicksLimit: 12, color: '#9aa9ba' },
                grid: { color: 'rgba(255,255,255,0.04)' }
              },
              y: {
                ticks: { color: '#9aa9ba' },
                grid: { color: 'rgba(255,255,255,0.06)' }
              }
            },
            plugins: {
              legend: { display: true, labels: { color: '#d8e1ea' } },
              tooltip: {
                callbacks: {
                  label: (ctx) => `${ctx.dataset.label}: ${fmt(ctx.parsed.y)}`,
                }
              }
            },
            elements: {
              line: { borderColor: closeColor },
              point: { radius: 0 }
            }
          }
        });

        // è‡ªå®šä¹‰å›¾ä¾‹ï¼ˆå¯é€‰ï¼‰
        const legend = document.getElementById(`legend-${sym}`);
        legend.innerHTML = [
          legendColorBox(closeColor, 'æ”¶ç›˜ä»·'),
          legendColorBox('#eab308', '3Y é«˜/ä½'),
          legendColorBox('#f97316', '1Y é«˜/ä½'),
          legendColorBox('#ef4444', '6M é«˜/ä½'),
        ].join('');

        // æ¦‚è¦æ•°å€¼ï¼ˆæœ€æ–°çª—å£å¯¹åº”çš„ 6 æ¡æ°´å¹³çº¿æ•°å€¼ï¼‰
        const summary = document.getElementById(`${sym}-summary`);
        summary.innerHTML = `
          <div class="kpi"><small><i class="dot" style="background:#eab308"></i>3Y High</small><b>${fmt(e3y.max)}</b></div>
          <div class="kpi"><small><i class="dot" style="background:#eab308"></i>3Y Low</small><b>${fmt(e3y.min)}</b></div>
          <div class="kpi"><small><i class="dot" style="background:#f97316"></i>1Y High</small><b>${fmt(e1y.max)}</b></div>
          <div class="kpi"><small><i class="dot" style="background:#f97316"></i>1Y Low</small><b>${fmt(e1y.min)}</b></div>
          <div class="kpi"><small><i class="dot" style="background:#ef4444"></i>6M High</small><b>${fmt(e6m.max)}</b></div>
          <div class="kpi"><small><i class="dot" style="background:#ef4444"></i>6M Low</small><b>${fmt(e6m.min)}</b></div>
        `;

      } catch (err) {
        card.innerHTML = `<div class="muted">${sym}ï¼š${err.message || err}</div>`;
      }
    }

    (async function init() {
      for (const s of symbols) await renderSymbol(s);
    })();
  </script>

  <!--
  ==== æ•°æ®æ–‡ä»¶ç¤ºä¾‹ï¼ˆdata/AAPL.jsonï¼‰====
  [
    { "date": "2023-08-07", "open": 179.69, "high": 180.12, "low": 176.0, "close": 178.85 },
    { "date": "2023-08-08", "open": 179.10, "high": 179.80, "low": 177.50, "close": 179.35 }
  ]
  - å»ºè®®æŒ‰æ—¥æœŸå‡åºæ’åˆ—ï¼ˆæ—§â†’æ–°ï¼‰ã€‚å¦‚æœæ— åºï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ’åºã€‚
  - ä½ ä¹Ÿå¯ä»¥åªä¿ç•™éœ€è¦çš„å­—æ®µï¼ˆä¾‹å¦‚ open/closeï¼‰ï¼Œä½† high/low æœªæ¥å¯èƒ½ä¼šç”¨åˆ°ã€‚
  -->
</body>
</html>
